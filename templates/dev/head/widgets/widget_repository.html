{% extends "base.html" %}

{% block content %}
<div ng-controller="WidgetRepository">
  <h3>Oppia Widget Repository</h3>
  <br>
  <div class="tabbable tabs-left">
    <ul class="nav nav-tabs">
      <li ng-repeat="(category, widgetList) in widgets" ng-class="{active: $index == 0}">
        <a data-toggle="tab" href="#<[category]>"><[category]></a>
      </li>
    </ul>
    <div class="tab-content">
      <div ng-repeat="(category, widgetList) in widgets" class="tab-pane" ng-class="{active: $index == 0}" id="<[category]>">
        <div class="container-fluid">
          <div class="row-fluid">

            <ul class="thumbnails">
              <li ng-repeat="widget in widgetList" class="span3">
                <div class="thumbnail">

                  <h5><[widget.name]></h5>
                  <i><[widget.blurb]></i>
                  <a ng-click="showCustomizeModal(category, $index)" ng-show="widget.params.length > 0">Customize</a>

                  <iframe id="widget-<[category]>-<[$index]>" frameborder="0" width="100%"></iframe>

                  {% if admin and not iframed %}
                    <button ng-click="editWidget(widget)">Edit this widget</button>
                  {% else %}
                    <center>
                      <button ng-click="selectWidget(category, $index)">
                        Use <[widget.name]>
                      </button>
                    </center>
                  {% endif %}

                </div>
              </li>
            </ul>

        </div>
      </div>
    </div>
  </div>


  <div ui-modal class="fade" id="editWidgetModal" ng-model="editWidgetModal">
    <div class="modal-header">
      <button ng-hide="newWidgetIsBeingAdded" type="button" class="close" data-dismiss="modal" aria-hidden="true"
              ng-click="closeEditorModal(modalWidget)">
        &times;
      </button>
      <button ng-show="newWidgetIsBeingAdded" type="button" class="close" data-dismiss="modal" aria-hidden="true"
              ng-click="closeEditorModal()">
        &times;
      </button>

      <h3 ng-show="newWidgetIsBeingAdded">Add new widget</h3>
      <h3 ng-hide="newWidgetIsBeingAdded">Edit this widget</h3>
    </div>

    <form name="saveWidgetForm" ng-submit="saveNewWidget(modalWidget)">
      <div class="modal-body">
        <div>
          Name: <input type="text" ng-model="modalWidget.name" name="newWidgetName" required not-duplicate-widget>
          <span ng-show="saveWidgetForm.newWidgetName.$error.notDuplicateWidget" class="alert">
            This widget name is already in use.
          </span>
        </div>
        <div>
          Category: <input type="text" ng-model="modalWidget.category" required>
        </div>
        <div>
          Description:
          <textarea ng-model="modalWidget.blurb" required>
          </textarea>
        </div>

        <ul class="nav nav-tabs" id="modalTabs">
          <li class="active"><a data-toggle="tab" href="#code">Code</a></li>
          <li><a data-toggle="tab" href="#preview">Preview</a></li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="code">
            Widget parameters:
            <div ng-repeat="param in modalWidget.params">
              <ul>
                <li>Name: <[param.name]></li>
                <li>Description: <[param.description]></li>
                <li>Type: <[param.type]></li>
                <li>Default value: <[param.default]></li>
              </ul>
            </div>
            <button ng-hide="activeInputData.name.substring(0, 23) == 'modalWidget.widgetParam'" ng-click="addParam()">Add parameter</button>
            <div ng-show="activeInputData.name.substring(0, 23) == 'modalWidget.widgetParam'">
              <ul>
                <li>Name: <input type="text" ng-model="newParamName"></li>
                <li>Description: <input type="text" ng-model="newParamDescription"></li>
                <li>Type: <input type="text" ng-model="newParamType"></li>
                <li>Default value: <input type="text" ng-model="newParamDefault"></li>
              </ul>
              <button ng-click="saveParam(modalWidget.params)">Save parameter</button>
            </div>

            <textarea class="oppia-code" ng-model="modalWidget.raw" rows="10" required>
            </textarea>
          </div>
          <div class="tab-pane" id="preview">
            <iframe id="modalPreview" width="100%" frameborder="0"></iframe>
          </div>
        </div>
      </div>

      <div class="modal-footer" ng-show="newWidgetIsBeingAdded">
        <input type="submit" class="btn" value="Save">
      </div>
    </form>

  </div>


  {% if admin and not iframed %}

    <div class="container-fluid">
      <div class="row-fluid">
        <button class="btn btn-large btn-success" ng-hide="newWidgetIsBeingAdded" type="button" ng-click="addWidget()">
          Add new widget
        </button>
      </div>
    </div>

  {% endif %}

  <div ui-modal class="fade" id="customizeModal" ng-model="modalShown">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
        &times;
      </button>
      <h3 id="customizeModalLabel">Customize this widget</h3>
    </div>
    <div class="modal-body">
      <p>
        Enter parameters below to customize your widget:
      </p>
      <form>
        <div ng-repeat="param in widgets[customizeCategory][customizeIndex].params">
          <[param.name]>: <input type="text" placeholder="<[param.default]>" ng-model="customizedParams[param.name]">
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <a class="btn" ng-click="submitCustomization()">Submit</a>
      <a class="btn" data-dismiss="modal" ng-click="closeCustomizeModal()">Close</a>
    </div>
  </div>

</div>
{% endblock %}
