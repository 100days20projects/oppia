{% extends "base.html" %}

{% block content %}
  <div ng-controller="StoryEditor">
    <div class="story-editor-header">
      <div class="collaborator-panel">
        <form ng-submit="addEditor()">
          Invite a collaborator:
          <input style="width: 200px" type="text" ng-model="newEditor" placeholder="Add Collaborator's Email" required>
          <input type="submit" value="+">
        </form>
        <div class="loading" id="addEditorLoading"></div>
      </div>
    </div>

    <div class="clear-floats"></div>

    <div class="content">
      <div class="left-col">

        <h3>Chapter Outline</h3>
        <div ng-repeat="chapter in chapters">
          <table class="no-border no-margin">
            <tr>
              <td class="chapter-cell" ng-class="{selected: $index==currChapter}">
                <[$index + 1]>:
                <a ng-show="$index != currChapter" ng-click="switchChapter($index)"><[chapter.desc]></a>
                <span ng-show="$index == currChapter"><[chapter.desc]></span>
              </td>
            </tr>
            <tr>
              <td ng-hide="$index == chapters.length - 1" class="connector-cell ghost-out" align="center">
                <div class="lock-image image-on-connector"></div>
                <hr class="chapter-connector">
              </td>
            </tr>
          </table>
        </div>
        <br>
        <form ng-submit="addChapter(newChapterName)">
          <input style="width: 80%" type="text" ng-model="newChapterName" placeholder="Add Chapter" required>
          <input type="submit" value="+">
        </form>
        <br><br>

        <h3>Reader navigation</h3>
        <div>
          <input type="radio" ng-model="storyNavigation" ng-change="saveStoryNav()" id="storyNav" value="story">
          <label for="storyNav">Story mode (hide navigation)</label>
        </div>
        <div>
          <input type="radio" ng-model="storyNavigation" ng-change="saveStoryNav()" id="courseNav" value="question_group">
          <label for="courseNav">Course mode (show navigation)</label>
        </div>
      </div>

      <div class="center-col">
        <div ng-repeat="warning in warnings">
          <p class="butterbar">
            <[warning]>
          </p>
        </div>

        <center class="help-box" ng-show="chapters[currChapter].groups.length == 0 || chapters[currChapter].groups[0].questions.length == 0">
          First time here? Add a topic below, then create new questions (on the right) and drag them into the topic boxes. You can click on a question to edit it.
        </center>

        <form ng-submit="saveChapterName(replacementChapterName)">
          <h3>Chapter <[currChapter + 1]>:
            <span class="chapter-name" ng-hide="currentActiveInput == 'chapterName'" ng-click="editChapterName(chapters[currChapter].desc)"> <[chapters[currChapter].desc]> </span>
            <span ng-show="currentActiveInput == 'chapterName'">
              <input style="width: 60%" type="text" ng-model="replacementChapterName" required>
              <input type="submit" value="Save">
            </span>
            <span class="loading" ng-show="saveChapterNameLoading"></span>
          </h3>
        </form>

        <div ng-repeat="group in chapters[currChapter].groups">
          <div class="question-group-row">
            <a class="close-button" ng-click="deleteQuestionGroup(group.id)">&times;</a>
            <span ng-class="{'ghost-out': !group.prereqDate && isEmpty(group.prereqMetrics)}" class="lock-image float-left" ng-click="editGroupPrereqs(group.id)"></span>
            <form ng-submit="saveGroupName(group.id, replacementGroupName)">
              <span class="group-name" ng-hide="currentActiveInput == 'groupName-' + group.id" ng-click="editGroupName(group.id, group.desc)"> <[group.desc]> </span>
              <span ng-show="currentActiveInput == 'groupName-' + group.id">
                <input style="width: 60%" type="text" ng-model="replacementGroupName" required>
                <input type="submit" value="Save">
              </span>
            </form>

            <div ng-show="currentActiveInput.indexOf('groupPrereqs-' + group.id) == 0">
              <br>
              <div class="prereq-edit-box">
                <a class="close-button" ng-click="clearActiveInputs()">&times;</a>
                <h5>Edit group prerequisites:</h5>
                <ul>
                  <li>
                    <form ng-submit="addGroupMetricPrereq(group.id, newGroupPrereqMetricName, newGroupPrereqMetricValue)">
                      Metrics:
                      <span ng-repeat="(key, value) in group.prereqMetrics" ng-click="editGroupPrereqMetricForm(group, key)">
                        <[key]> ≥ <[value]>
                      </span>
                      <span ng-show="isEmpty(group.prereqMetrics)">
                        <input type="text" placeholder="Add Metric Prerequisite" ng-model="$parent.newGroupPrereqMetricName">
                        ≥
                        <input type="number" ng-model="$parent.newGroupPrereqMetricValue">
                        <input type="submit" value="+">
                      </span>
                    </form>
                  </li>
                  <li>
                    Release date:
                    <input type="date" ng-model="group.prereqDate" ng-change="saveGroupPrereqs(group)">
                  </li>
                </ul>
              </div>
            </div>

            <br><br>
            <div ng-repeat="question in group.questions" class="question-box question-box-in-group id-<[question.id]>">
              <a ng-click="editQuestion(question)">
                <[question.desc]>
              </a>
            </div>
            <div class="padding-row no-border"></div>
            <br>
            <div>
              <center class="add-content-box group-id-<[group.id]>">
                Drag Content Here
              </center>
            </div>
            <br>

          </div>
        </div>
        <div class="padding-row no-border"></div>
        <div>
          <div align="center">
            <form ng-submit="addQuestionGroup(newQuestionGroupName)">
              <input style="width: 80%" type="text" ng-model="newQuestionGroupName" placeholder="Add Topic" required>
              <input type="submit" value="+">
            </form>
          </div>
        </div>
      </div>

      <div class="right-col">
        <h4>Create New Content</h4>
        <form ng-submit="addQuestion()">
          <input style="width: 80%" type="text" ng-model="newQuestionName" placeholder="Add Content Name" required>
          <input type="submit" value="+">
          <div class="loading" id="addQuestionLoading"></div>
        </form>
        <br>
        <h4>List of Unused Content</h4>
        <br>
        <div ng-repeat="question in chapters[currChapter].freeQuestions">
          <div class="question-box id-<[question.id]>">
            <a ng-click="editQuestion(question)"><[question.desc]></a>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
