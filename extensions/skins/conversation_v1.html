<div ng-controller="ReaderExploration" ng-style="getStyle()">
  <div ng-if="!iframed" class="oppia-hide-if-small-screenwidth">
    <div class="oppia-feedback-button" ng-click="showFeedbackModal()">
      <center>
        <br><br><br>Feedback
      </center>
    </div>

    <script type="text/ng-template" id="modals/readerFeedback">
      <div class="modal-header">
        <h3>Give Feedback to the Exploration Editors</h3>
      </div>

      <div class="modal-body">
        <em>
          <p>
            This form will start a new feedback thread on the exploration editor page, so that the exploration can be improved. If you like, you can give feedback anonymously by checking the box at the bottom.
          </p>
          <p>
            Note: This form is meant for exploration-specific feedback. To give general feedback about Oppia, please consider using the <a href="https://code.google.com/p/oppia/issues/list"> bug tracker</a> or <a href="https://groups.google.com/forum/?fromgroups#!forum/oppia-dev">Google Group</a>. Thanks in advance!
          </p>
        </em>

        <form role="form">
          <div class="form-group">
            <label for="subject">Subject</label>
            <input type="text" class="form-control" id="subject" ng-model="subject">
          </div>
          <label for="feedback">Feedback</label>
          <textarea id="feedback" class="form-control" ng-model="feedback" rows="6" cols="200" placeholder="Please write your feedback or suggestions for the exploration editors here."></textarea>
          <div class="radio">
            <label>
              <input type="radio" ng-model="relatedTo" name="relatedTo" id="relatedToState" value="state">
              This feedback relates to the current question.
            </label>
          </div>
          <div class="radio">
            <label>
              <input type="radio" ng-model="relatedTo" name="relatedTo" id="relatedToExploration" value="exploration">
              This feedback relates to the exploration as a whole.
            </label>
          </div>
        </form>

        <div ng-show="isLoggedIn">
          <hr>
          <div class="checkbox">
            <label>
              <input type="checkbox" ng-model="isSubmitterAnonymized">
              Give feedback anonymously
            </label>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-success" ng-click="submit(subject, feedback, relatedTo, isSubmitterAnonymized)">Submit</button>
        <button class="btn btn-default" ng-click="cancel()">Cancel</button>
      </div>
    </script>

    <script type="text/ng-template" id="modals/readerFeedbackConfirmation">
      <div class="modal-header">
        <h3>Thank you for giving feedback</h3>
      </div>

      <div class="modal-body">
        <p>
          Your feedback has been successfully submitted, and the exploration editors will see it when they next visit the exploration editing page.
        </p>
        <p>
          Thank you for helping to improve this exploration!
        </p>
      </div>

      <div class="modal-footer">
        <button class="btn btn-default" ng-click="cancel()">Close</button>
      </div>
    </script>
  </div>

  <div class="oppia-content" role="main">
    <div class="oppia-exploration-header">
      <a href="" ng-click="resetPage()" class="pull-right oppia-exploration-header-sublink">
        Clear history and restart
      </a>
      <h3 role="heading"><[title]></h3>
    </div>

    <div class="oppia-iframe-container oppia-exploration">
      <div ng-repeat="response in responseLog track by $index"
           ng-class="{'oppia-last-log-entry': $last}"
           aria-live="<[$last ? 'polite' : 'off']>"
           aria-atomic="true">

        <div class="oppia-conversation-log"
             angular-html-bind="response.previousReaderAnswer">
        </div>
        <div class="oppia-conversation-log"
             angular-html-bind="response.feedback">
        </div>

        <div ng-if="response.question">
          <div ng-if="!response.isMostRecentQuestion"
               class="oppia-conversation-log"
               angular-html-bind="response.question">
          </div>
          <div ng-if="response.isMostRecentQuestion"
               class="oppia-response oppia-log-title"
               angular-html-bind="response.question">
          </div>
        </div>
      </div>

      <br>

      <div ng-show="finished" class="oppia-response-finished">
        Congratulations, you've finished this exploration!
        Would you like to <a ng-click="resetPage()" href="">play again?</a>
      </div>

      <div ng-hide="finished">
        <!-- This iframe must always be contained within a div in
        which it is the only element. For more information, please
        see the ReaderExploration.js file. -->
        <div ng-hide="answerIsBeingProcessed">
          <div angular-html-bind="inputTemplate"></div>
        </div>
        <div ng-show="answerIsBeingProcessed">
          <center style="font-size: 8em;">
            <span class="oppia-loading-dot-one">.</span>
            <span class="oppia-loading-dot-two">.</span>
            <span class="oppia-loading-dot-three">.</span>
          </center>
        </div>
      </div>
    </div>
  </div>
</div>
