<script type="text/ng-template" id="skins/Conversation">
  <link rel="stylesheet" type="text/css"
        href="/extensions/skins/conversation_v1/static/conversation.css">

  <!-- Off-screen preview of future card in order to pre-determine the target height for the animation. -->
  <md-card class="conversation-skin-tutor-card" style="position: absolute; left: -30000px; top: -30000px;">
    <div id="futurePreview">
      <div class="conversation-skin-tutor-card-top-section">
        <img class="conversation-skin-initial-oppia-avatar" src="/images/general/o_black_72px.png">
        <div class="protractor-test-conversation-content" angular-html-bind="upcomingContentHtml">
        </div>
      </div>

      <div ng-if="activeCard.interactionIsInline && upcomingInlineInteractionHtml">
        <div class="conversation-skin-inline-interaction">
          <img class="conversation-skin-user-avatar img-circle" ng-src="<[profilePicture]>">
          <div class="protractor-test-conversation-input" angular-html-bind="upcomingInlineInteractionHtml">
          </div>
        </div>
      </div>
    </div>
  </md-card>

  <!-- TODO(sll): do we need to preserve the itemprop attr? -->
  <div role="main" style="margin: 0 auto; position: relative;">
    <progress-dots num-dots="numProgressDots" current-dot-index="currentProgressDotIndex" class="conversation-skin-progress-dots">
    </progress-dots>

    <div class="conversation-skin-cards-container conversation-skin-animate-cards" ng-class="{'animate-to-two-cards': isAnimatingToTwoCards, 'animate-to-one-card': isAnimatingToOneCard}">
      <md-card class="conversation-skin-tutor-card" ng-class="{'conversation-skin-left-card': !activeCard.interactionIsInline && canWindowFitTwoCards()}" ng-show="isPanelVisible(PANEL_TUTOR)">
        <div class="conversation-skin-tutor-card-feedback-toggle-container" ng-if="activeCard.stateName && !isInPreviewMode">
          <span class="glyphicon glyphicon-comment conversation-skin-tutor-card-feedback-toggle"
                popover-placement="<[isWindowNarrow() ? 'left' : 'bottom']>"
                popover-template="popover/feedback" popover-trigger="click"
                tooltip="Feedback" tooltip-placement="bottom"
                state-name="<[activeCard.stateName]>">
          </span>
        </div>

        <div class="conversation-skin-animate-card-contents" ng-class="{'animate-card-change': startCardChangeAnimation}">
          <div class="conversation-skin-tutor-card-top-section">
            <img class="conversation-skin-initial-oppia-avatar" src="/images/general/o_black_72px.png">
            <div class="protractor-test-conversation-content" angular-html-bind="activeCard.content">
            </div>
          </div>

          <div ng-if="activeCard.answerFeedbackPairs.length > 1">
            <h4 class="conversation-skin-responses-dropdown-container" ng-click="toggleShowPreviousResponses()">
              <span class="conversation-skin-responses-dropdown-text">
                Previous responses
                <span ng-if="!arePreviousResponsesShown">
                  <span class="glyphicon glyphicon-play" style="font-size:10px; margin-bottom: -4px;"></span>
                </span>
                <span ng-if="arePreviousResponsesShown">
                  <span class="glyphicon glyphicon-triangle-bottom" style="font-size:10px; margin-bottom: -4px;"></span>
                </span>
              </span>
            </h4>
          </div>

          <div class="conversation-skin-tutor-card-middle-section" ng-if="arePreviousResponsesShown">
            <div ng-repeat="responsePair in activeCard.answerFeedbackPairs track by $index">
              <div ng-if="!$last">
                <answer-feedback-pair profile-picture="profilePicture"
                                      answer="responsePair.learnerAnswer"
                                      feedback="responsePair.oppiaFeedback">
                </answer-feedback-pair>
              </div>
            </div>
          </div>

          <!-- Always show the most recent response pair, if there is one. -->
          <div class="conversation-skin-tutor-card-bottom-section" ng-if="activeCard.answerFeedbackPairs.length > 0">
            <answer-feedback-pair profile-picture="profilePicture"
                                  answer="activeCard.answerFeedbackPairs[activeCard.answerFeedbackPairs.length - 1].learnerAnswer"
                                  feedback="activeCard.answerFeedbackPairs[activeCard.answerFeedbackPairs.length - 1].oppiaFeedback">
            </answer-feedback-pair>
          </div>

          <div ng-if="!waitingForOppiaFeedback && (activeCard.interaction || waitingForContinueButtonClick) && currentProgressDotIndex === transcript.length - 1">
            <div class="conversation-skin-inline-interaction">
              <img class="conversation-skin-user-avatar img-circle" ng-src="<[profilePicture]>">
              <div ng-if="waitingForContinueButtonClick">
                <md-button class="md-button-success" focus-on="<[CONTINUE_BUTTON_FOCUS_LABEL]>"
                           ng-click="showPendingCard(upcomingStateName, upcomingContentHtml)">
                  Continue
                </md-button>
              </div>
              <div ng-if="activeCard.interaction && !activeCard.interactionIsDisabled">
                <div ng-if="activeCard.interactionIsInline">
                  <div class="protractor-test-conversation-input"
                       angular-html-bind="activeCard.interaction">
                  </div>
                </div>
                <div ng-if="!activeCard.interactionIsInline" ng-click="setVisiblePanel(PANEL_INTERACTION)" ng-class="{'conversation-skin-interaction-clickable-instructions': panels.length > 1}" style="opacity: 0.8;">
                  (<[activeCard.interactionInstructions]>)
                  <i class="zmdi zmdi-arrow-right"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </md-card>

      <div class="conversation-skin-supplemental-card-container"
           ng-class="{'conversation-skin-right-card-container': !activeCard.interactionIsInline && isPanelVisible(PANEL_TUTOR) && isPanelVisible(PANEL_INTERACTION)}"
           ng-show="!activeCard.interactionIsInline && activeCard.interaction">
        <div ng-if="activeCard.interactionIsDisabled" class="conversation-skin-supplemental-card-overlay">
        </div>
        <!--
          This needs to use ng-show and a loop over the transcript, so that the
          state of previous supplemental interactions is preserved.
        -->
        <md-card class="conversation-skin-supplemental-card" ng-show="isPanelVisible(PANEL_INTERACTION)">
          <div ng-repeat="transcriptCard in transcript">
            <div class="protractor-test-conversation-input" angular-html-bind="transcriptCard.interaction" ng-show="$index === currentProgressDotIndex">
            </div>
          </div>
        </md-card>
      </div>
    </div>
  </div>

  <div ng-if="finished && isLoggedIn && !isInPreviewMode && !isIframed" class="conversation-skin-final-ratings">
    <oppia-gadget-panel panel-contents="gadgetPanelsContents.main" class="conversation-skin-main-gadget-panel"></oppia-gadget-panel>

    <div style="margin-bottom: 20px;">Learned something new? How would you rate this exploration?</div>
    <div popover-placement="bottom" popover-template="popover/feedback" popover-trigger="click">
      <rating-from-value rating-value="userRating" is-editable="true" on-edit="submitUserRating" style="letter-spacing: 10px;">
      </rating-from-value>
    </div>
  </div>

  <div class="conversation-skin-card-switcher" ng-if="panels.length >= 2">
    <div class="conversation-skin-card-switcher-thumbnails-container">
      <span ng-repeat="panelName in panels">
        <img class="conversation-skin-card-switcher-thumbnail img-circle" ng-src="<[getThumbnailSrc(panelName)]>" ng-click="setVisiblePanel(panelName)" ng-class="{'conversation-skin-card-switcher-thumbnail-active': isPanelVisible(panelName)}">
      </span>
    </div>
  </div>
</script>

<script type="text/ng-template" id="components/answerFeedbackPair">
  <div class="conversation-skin-learner-answer-container">
    <img class="conversation-skin-user-avatar" ng-src="<[profilePicture()]>">
    <div class="conversation-skin-learner-answer" angular-html-bind="answer()">
    </div>
  </div>

  <div class="conversation-skin-oppia-feedback-container" ng-if="feedback() !== ''">
    <img class="conversation-skin-oppia-avatar img-circle" src="/images/general/o_black_72px.png">

    <div class="conversation-skin-oppia-feedback protractor-test-conversation-feedback">
      <div ng-if="feedback() === null">
        <div class="conversation-skin-feedback-dot-one"></div>
        <div class="conversation-skin-feedback-dot-two"></div>
        <div class="conversation-skin-feedback-dot-three"></div>
      </div>
      <div ng-if="feedback() !== null" angular-html-bind="feedback()"></div>
    </div>
  </div>
</script>

<script type="text/ng-template" id="components/progressDots">
  <style>
    @keyframes oppia-animate-enter-progress-dot {
      0% {
        margin-left: -10px;
      }

      100% {
        margin-left: 0;
      }
    }

    .oppia-progress-arrow {
      color: #ccc;
      display: inline-block;
      margin-left: 10px;
      vertical-align: middle;
      -webkit-user-select: none;
      user-select: none;
    }
    .oppia-progress-arrow-active {
      color: #fff;
      cursor: pointer;
    }

    .oppia-progress-dot {
      border-radius: 50%;
      float: left;
      height: 12px;
      margin-left: 10px;
      width: 12px;
    }
    .oppia-progress-dot-active {
      background-color: #fff;
    }
    .oppia-progress-dot-inactive {
      background-color: #ccc;
      cursor: pointer;
    }

    .oppia-progress-dot-list {
      list-style-type: none;
      margin: 10px auto;
      padding-left: 0;
      position: relative;
      text-align: center;
    }

    .oppia-animate-progress-dot {
      display: inline-block;
      vertical-align: middle;
    }
    .oppia-animate-progress-dot.ng-enter {
      -webkit-animation: 400ms oppia-animate-enter-progress-dot;
      animation: 400ms oppia-animate-enter-progress-dot;
      -webkit-animation-timing-function: linear;
      animation-timing-function: linear;
    }
  </style>

  <ul class="oppia-progress-dot-list">
    <li class="oppia-progress-arrow" ng-show="dots.length > 1"
        ng-class="{'oppia-progress-arrow-active' : currentDotIndex > 0}"
        ng-click="decrementCurrentDotIndex()">
      <span class=" glyphicon glyphicon-arrow-left">
      </span>
    </li>
    <li ng-repeat="dot in dots track by $index" class="oppia-animate-progress-dot">
      <span class="oppia-progress-dot oppia-progress-dot-active"
            ng-if="$index === currentDotIndex" ng-show="dots.length > 1">
      </span>
      <span class="oppia-progress-dot oppia-progress-dot-inactive"
            ng-if="$index !== currentDotIndex"
            ng-click="changeActiveDot($index)">
      </span>
    </li>
    <li class="oppia-progress-arrow" ng-show="dots.length > 1"
        ng-class="{'oppia-progress-arrow-active' : currentDotIndex != dots.length - 1}"
        ng-click="incrementCurrentDotIndex()">
      <span class=" glyphicon glyphicon-arrow-right">
      </span>
    </li>
  </ul>
</script>
