{% extends "base.html" %}

{% block subtitle %}
  Dashboard
{% endblock subtitle %}

{% block navbar_breadcrumb %}
  <ul class="nav navbar-nav oppia-navbar-breadcrumb" ng-controller="DashboardNavbarBreadcrumb">
    <li>
      <span class="oppia-navbar-breadcrumb-separator"></span>
      Dashboard
      <span class="oppia-navbar-breadcrumb-separator" style="margin-left: 5px;"></span>
      <span>
        <[activeTabNames[activeTab]]>
      </span>
    </li>
  </ul>

  <style>
    html, body {
      background-color: #eee;
    }
  </style>
{% endblock navbar_breadcrumb %}

{% block local_top_nav_options %}
  <ul class="nav navbar-nav oppia-navbar-nav navbar-right" ng-controller="DashboardLocalNav"
      style="margin-left: 35px; margin-right: 0px;">
    <li ng-class="{'active': activeTab === 'timeline'}">
      <a href="" title="Timeline" tooltip="Timeline" tooltip-placement="bottom" ng-click="setActiveTab('timeline')">
        <span class="glyphicon glyphicon-time" style="transform: rotate(-90deg);"></span>
      </a>
    </li>
    <li ng-class="{'active': activeTab === 'myExplorations'}">
      <a href="" title="My Explorations" tooltip="Explorations" tooltip-placement="bottom" ng-click="setActiveTab('myExplorations')">
        <span class="glyphicon glyphicon-th-list"></span>
      </a>
    </li>
  </ul>

  <ul class="nav navbar-nav oppia-navbar-nav navbar-right ng-cloak" ng-controller="CreateExplorationButton">
    <li>
      <div class="oppia-navbar-button-container">
        <a class="btn oppia-navbar-add-exploration-button protractor-test-create-exploration"
           ng-click="showCreateExplorationModal()" style="margin-right: 0;">
          <span class="oppia-navbar-add-exploration-button-plus">+</span>
          <span>Create Exploration</span>
        </a>
      </div>
    </li>
  </ul>
{% endblock local_top_nav_options %}

{% block content %}
  <div class="oppia-dashboard-container" ng-controller="Dashboard">
    <div ng-if="activeTab === 'timeline'">
      <h2>Timeline</h2>
      <span class="pull-right" style="font-size: smaller; position: absolute; opacity: 0.7; top: 130px;">
        Last updated: <[getLocaleAbbreviatedDatetimeString(jobQueuedMsec)]>
      </span>
      <md-card class="oppia-page-card oppia-timeline-card">
        <div ng-if="jobQueuedMsec">
          <!-- This seems to be needed because otherwise, in Firefox, the 'last updated' string gets merged into the table of recent updates. -->
          <br>
        </div>

        <div ng-if="recentUpdates.length === 0">
          <em>No recent updates.</em>
        </div>

        <div ng-if="recentUpdates.length > 0">
          <table class="table">
            <tr>
              <th></th>
              <th></th>
              <th>Exploration</th>
              <th>Last updated</th>
              <th>by</th>
              <th>Subject</th>
            </tr>
            <tr ng-repeat="update in recentUpdates"
                ng-class="{'oppia-dashboard-row-recent': lastSeenMsec && lastSeenMsec < update.last_updated_ms && update.author_username !== currentUsername, 'oppia-dashboard-row': !lastSeenMsec || lastSeenMsec >= update.last_updated_ms || update.author_username === currentUsername}"
                ng-click="navigateToItem(update.activity_id, update.type)">
              <td>
                <span class="label label-primary"
                      ng-if="lastSeenMsec && lastSeenMsec < update.last_updated_ms && update.author_username !== currentUsername">
                  New
                </span>
              </td>
              <td>
                <span ng-if="update.type === 'exploration_commit'"
                      class="glyphicon glyphicon-flag"
                      title="Exploration commit"></span>
                <span ng-if="update.type === 'feedback_thread'"
                      class="glyphicon glyphicon-comment"
                      title="Feedback thread"></span>
              </td>
              <td><[update.activity_title]></td>
              <td><[getLocaleAbbreviatedDatetimeString(update.last_updated_ms)]></td>
              <td><[update.author_username]></td>
              <td><[update.subject]></td>
            </tr>
          </table>
        </div>
      </md-card>
    </div>

    <div ng-if="activeTab === 'myExplorations'">
      <h2>My Explorations</h2>

      <div ng-if="!isEmpty(explorationsList)">
        <ul class="oppia-dashboard-tiles">
          <li ng-repeat="exploration in explorationsList">
            {% include 'dashboard/tiles.html' %}
          </li>
        </ul>
      </div>

      <div ng-if="isEmpty(explorationsList)">
        <p>
          <em>You currently aren't managing or collaborating on any explorations.</em>
        </p>
      </div>
    </div>
  </div>

  {% include 'components/exploration_creation_button.html' %}
{% endblock %}

{% block footer_js %}
  {{ super() }}
  <script>
    {{ include_js_file('components/explorationCreationButton.js') }}
    {{ include_js_file('/dashboard/Dashboard.js') }}
  </script>
{% endblock footer_js %}
