<table style="vertical-align: top; width: 100%">
  <tr>
    <td colspan="2" ng-class="getCssClassForRule(rule)">
      <center style="font-weight: bold;">
        <span ng-if="isRuleConfusing(rule)">
          <i class="icon-warning-sign" title="This rule loops back to the same state and has no feedback, so it will probably confuse readers."></i>
        </span>

        <span ng-if="activeEditor !== 'ruleDescription'">
          <span angular-html-bind="rule | parameterizeRuleDescription: choices"></span>
          <button ng-if="rule.description !== 'Default'" ng-click="openRuleDescriptionEditor()">Edit</button>
        </span>

        <span ng-if="activeEditor === 'ruleDescription'">
          <div ng-if="!ruleDescriptionPickerIsOpen">
            <span ng-if="rule.description !== 'Default'">
              Answer
            </span>
            <span ng-repeat="item in ruleDescriptionFragments track by $index">
              <span ng-if="item.type == 'select'">
                <select ng-model="rule.definition.inputs[item.varName]" ng-options="choice.id as choice.val for choice in getExtendedChoiceArray(choices.value)">
                </select>
              </span>
              <span ng-if="item.type != 'select' && item.type != 'noneditable'">
                <object-editor obj-type="<[item.type]>" always-editable="true" value="rule.definition.inputs[item.varName]"></object-editor>
              </span>
              <span ng-if="item.type == 'noneditable'">
                <[item.text]>
              </span>
            </span>

            <button ng-click="openRuleDescriptionPicker()" class="pull-right">
              Change Rule Type
            </button>
          </div>

          <div ng-if="ruleDescriptionPickerIsOpen">
            <h5 style="text-align: left;">Select a rule type</h5>
            <div ng-repeat="(description, name) in allRuleTypes" class="oppia-rule">
              Answer <span ng-bind-html="description | bracesToText"></span>
              <button type="button" class="pull-right"
                      ng-click="selectNewRuleType(description, name)">
                Select
              </button>
            </div>
          </div>

          <button class="btn btn-success pull-right" ng-if="!ruleDescriptionPickerIsOpen" ng-click="closeRuleDescriptionEditor()">Save and close</button>
        </span>
      </center>
    </td>
  </tr>
  <tr>
    <td class="oppia-feedback-bubble">
      <div ng-if="activeEditor !== 'ruleFeedback'">
        <span ng-if="rule.feedback.length === 0">
          <em>This rule provides no feedback.</em>
        </span>
        <span ng-repeat="fb in rule.feedback">
          • <span angular-html-bind="fb"></span><br>
        </span>
        <button ng-click="openRuleFeedbackEditor()">Edit</button>
      </div>

      <div ng-if="activeEditor === 'ruleFeedback'">
        <p>Feedback for the reader (chosen at random from the following):</p>
        <object-editor obj-type="List" init-args="FEEDBACK_LIST_INIT_ARGS" value="rule.feedback">
        </object-editor>
        <button ng-click="closeRuleFeedbackEditor()">Save and close</button>
      </div>
    </td>
    <td class="oppia-dest-bubble">
      <div class="oppia-align-center" ng-if="activeEditor !== 'ruleDest'">
        <span ng-if="rule.dest == getActiveStateName()">
          ⟳ <[rule.dest]>
        </span>
        <span ng-if="rule.dest == 'END'">
          <[rule.dest]>
        </span>
        <span ng-if="rule.dest != 'END' && rule.dest != getActiveStateName()">
          <a href="/create/<[explorationId]>#/gui/<[rule.dest]>">
            <[rule.dest]>
          </a>
        </span>

        <button ng-click="openRuleDestEditor()">Edit</button>
      </div>

      <div class="oppia-align-center" ng-if="activeEditor === 'ruleDest'">
        Destination:
        <select2-dropdown item="rule.dest" choices="allDests" placeholder="Select a destination state" new-choice-regex="^[A-Z a-z]+$">
        </select2-dropdown>
        <span ng-if="rule.dest == stateName"> ⟳ </span>

        <button ng-click="closeRuleDestEditor()">Save and close</button>
      </div>
    </td>
  </tr>
</table>
