{% extends "base.html" %}

{% block maintitle %}
  Oppia Editor
{% endblock maintitle %}

{% block subtitle %}
  {{ title }}
{% endblock subtitle %}


{% block header_js %}
  {{ super() }}
  <script type="text/javascript">
    GLOBALS.collectionId = JSON.parse('{{collection_id|js_string}}');
    GLOBALS.canEdit = JSON.parse('{{can_edit|js_string}}');
  </script>

  <style>
    html, body {
      background-color: #eee;
    }
  </style>

  {{dependencies_html}}
{% endblock header_js %}


{% block content %}
  <div ng-controller="CollectionEditor">
    <div ng-if="collection">
      <!-- Collection details !-->
      <collection-details-directive
        title="collection.title" category="collection.category"
        objective="collection.objective" version="collection.version"
        add-change="addChange(change)" set-collection-title="setCollectionTitle(newTitle)"
        set-collection-objective="setCollectionObjective(newObjective)" set-collection-category="setCollectionCategory(newCategory)"
        add-collection-node="addCollectionNode(expId)">
      </collection-details-directive>
      <a ng-href="/collection/<[collection.id]>" target="_blank">Go to Collection</a>

      <!-- List of acquired and pre-requisite skills !-->
      <br>
      <br>
      <strong>Skills</strong>
      <collection-skills-list-directive collection-skills="collectionSkills">
      </collection-skills-list-directive>

      <!-- List of explorations !-->
      <br>
      <strong>Explorations</strong>
      <ul>
        <li ng-repeat="node in collection.nodes">
          <collection-node-directive
            prerequisite-skills="node.prerequisite_skills" acquired-skills="node.acquired_skills"
            exploration-id="node.exploration.id" exploration-title="node.exploration.title"
            add-change="addChange(change)" add-prerequisite-skill="addPrerequisiteSkill(skillName, expId)"
            add-acquired-skill="addAcquiredSkill(skillName, expId)" delete-collection-node="deleteCollectionNode(expId)"
            delete-acquired-skill="deleteAcquiredSkill(skillIdx, expId)" delete-prerequisite-skill="deletePrerequisiteSkill(skillIdx, expId)"></collection-node-directive>
        </li>
      </ul>

      <!-- Collection changes to be commited !-->
      <h3><span ng-if="changeList.length > 0"> <em>(<[changeList.length]> changes pending)</em></h3>
      <br>
      <input ng-model="commitMessage" type="text" placeholder="Commit Message"><button ng-click="saveCollection(commitMessage)">Save Collection</button>
    </div>
  </div>

  {% include 'collection_editor/collection_details_directive.html' %}
  {% include 'collection_editor/collection_node_directive.html' %}
  {% include 'collection_editor/collection_skills_list_directive.html' %}
{% endblock content %}


{% block footer_js %}
  {{ super() }}
  <script>
    {{ include_js_file('collection_editor/CollectionEditor.js') }}
    {{ include_js_file('collection_editor/CollectionDetailsDirective.js') }}
    {{ include_js_file('collection_editor/CollectionNodeDirective.js') }}
    {{ include_js_file('collection_editor/CollectionSkillsListDirective.js') }}
    {{ include_js_file('domain/collection/CollectionBackendApiService.js') }}
    {{ include_js_file('domain/collection/CollectionUpdateService.js') }}
    {{ include_js_file('domain/collection/WritableCollectionBackendApiService.js') }}
    {{ include_js_file('domain/utilities/UrlInterpolationService.js') }}
  </script>
{% endblock footer_js %}
