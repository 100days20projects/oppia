{% extends "base.html" %}

{% block subtitle %}
  Main Page
{% endblock subtitle %}

{% block content %}
  <div class="oppia-content">
    <style>
    </style>

    <oppia oppia-id="0" width="100%" id="demoExploration"></oppia>

    <script>
      window.addEventListener('message', function(evt) {
        if (evt.origin == 'https://oppiaserver.appspot.com' || 
            evt.origin == window.location.protocol + '//' + window.location.host) {
          if (event.data.hasOwnProperty('explorationHeight')) {
            console.log('Received iframe height from embedded oppia exploration: ' + event.data.explorationHeight);

            // Change the height of the included iframe.
            var iframe = document.getElementById('demoExploration');
            iframe.height = parseInt(event.data.explorationHeight, 10) + 'px';

            var targetFrame = $('#demoExploration')[0];
            targetFrame.contentWindow.postMessage('heightAdjustedExternally', '*');

            setTimeout(function () {
              $('#buttons').show();
            }, 2000);
          }
        }        
      }, false);

      var currSource = window.location.protocol + '//' + window.location.host;
      var oppiaList = document.getElementsByTagName('oppia');
      
      for (var i = 0; i < oppiaList.length; i++) {
        var oppiaNode = oppiaList[i];

        // TODO(sll): Add error handling here if required attrs are not
        // present. Show an error message in the iframe if anything 
        // fails to load.
        if (!oppiaNode.getAttribute('oppia-id')) {
          console.log('Error: oppia node has no id.');
          continue;
        }

        var iframe = document.createElement('iframe');
        iframe.setAttribute('id', oppiaNode.getAttribute('id'));
        iframe.setAttribute(
          'src',
          (oppiaNode.getAttribute('src') || currSource) + 
              '/learn/' + oppiaNode.getAttribute('oppia-id') + '?iframed=true');
        iframe.setAttribute('seamless', 'seamless');
        iframe.setAttribute(
          'height', oppiaNode.getAttribute('height') || '700px');
        iframe.setAttribute('width', oppiaNode.getAttribute('width') || '100%');
        iframe.setAttribute('frameborder', 0);
        iframe.setAttribute('style', 'margin: 10px;');
        iframe.setAttribute('class', 'oppia-no-scroll');

        oppiaNode.parentNode.replaceChild(iframe, oppiaNode);
      }
    </script>

    <hr>
    <div class="row-fluid" id="buttons" style="display: none;">
      <div class="span6">
        <center class="oppia-btn-container">
          <a class="btn oppia-btn" href="/gallery">Browse more explorations</a>
        </center>
      </div>
      <div class="span6">
        <center class="oppia-btn-container">
          <a class="btn oppia-btn" href="/learn_random">Play a new exploration</a>
        </center>
      </div>
    </div>

  </div>
{% endblock %}
