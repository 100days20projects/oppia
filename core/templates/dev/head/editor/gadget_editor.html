<div ng-controller="GadgetEditor">
  <span style="font-size: 16px;">
    <strong>Gadgets</strong>
  </span>
  <md-card style="background: white; margin: 20px 0px; padding: 10px 10px;">
    <button type="button" class="btn btn-default btn-xs oppia-add-gadget-button"
            ng-click="addNewGadget()">
      Insert Gadget
    </button>
  </md-card>
  <div ng-show="gadgets">
    <div ng-repeat="(panelName, panelContents) in panels"
         class="oppia-<[panelName]>-editor-gadget-panel">
      <div ng-repeat="gadgetName in panelContents">
        <span title="Delete <[gadgetName]>" ng-click="deleteGadget(gadgetName)"
              class="glyphicon glyphicon-remove oppia-gadget-delete-icon">
        </span>
        <span title="Rename <[gadgetName]>"
              ng-click="onOpenGadgetNameEditor(gadgetName)"
              class="glyphicon glyphicon-pencil oppia-gadget-rename-icon">
        </span>
        <span ng-show="originalNameForRenamedGadget == gadgetName"
              class="oppia-rename-gadget-form">
          <input type="text" ng-model="newNameForRenamedGadget">
          <button class="btn btn-default btn-sm"
                  ng-click="renameGadget(newNameForRenamedGadget)">
            Done
          </button>
        </span>
        <div class="oppia-gadget-preview-container"
             ng-click="editGadget(gadgetName)">
          <oppia-gadget-preview
            gadget-type="gadgets[gadgetName].gadget_type"
            gadget-name="gadgetName" style="pointer-events: none;"
            gadget-customization-args="gadgets[gadgetName].customization_args"
            visible-in-states="gadgets[gadgetName].visible_in_states">
          </oppia-gadget-preview>
          <span title="Edit Gadget Content"
                class="glyphicon glyphicon-edit oppia-gadget-edit-icon">
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/ng-template" id="modals/customizeGadget">
  <div class="modal-header" style="border-bottom: 0; padding-bottom: 0;">
    <h3 ng-if="!gadgetDict.gadget_type">
      Insert a gadget
    </h3>
    <h3 ng-if="gadgetDict.gadget_type">
      Customize Gadget (<[gadgetDict.gadget_name]>)
    </h3>
  </div>
  <div class="modal-body">
    <div ng-if="!gadgetDict.gadget_type" ng-cloak>
      <span class="oppia-gadget-tile"
            ng-repeat="(gadgetType, gadget) in ALLOWED_GADGETS"
            ng-click="onChangeGadgetType(gadgetType)">
        <[gadgetType]>
      </span>
    </div>
    <div ng-if="gadgetDict.gadget_type" class="customization-editor">
      <div ng-show="!isEditingGadget" class="gadget-name-panel">
        <label>Gadget Name</label>
        <input ng-disabled="isEditingGadget" ng-model="gadgetDict.gadget_name">
      </div>
      <div ng-show="!isEditingGadget" class="gadget-layout-panel">
        <label class="oppia-gadget-customization-label">Layout</label>
        <select ng-options="panelName for panelName in availablePanels"
                ng-model="gadgetDict.panel_name"
                style="text-transform: capitalize;">
        </select>
      </div>
      <div class="gadget-state-visibility-panel">
        <h2 class="oppia-gadget-customization-label">Visible in states</h2>
        <label class="oppia-gadget-customization-label"
               ng-repeat="state in allExplorationStateNames">
          <input type="checkbox" ng-click="toggleVisibilityInState(state)"
                 ng-checked="gadgetDict.visible_in_states.indexOf(state) > -1">
          <[state]>
        </label>
      </div>
      <form name="form.schemaForm">
        <div ng-if="customizationArgSpecs.length === 0">
          <em>
            There are no customization options available.
            <br><br>
            To use this gadget, click 'Save Gadget'.
          </em>
        </div>

        <div ng-repeat="customizationArgSpec in customizationArgSpecs">
          <div class="oppia-gadget-customization-label">
            <[customizationArgSpec.description]>
          </div>
          <div>
            <schema-based-editor
              schema="customizationArgSpec.schema"
              local-value="gadgetDict.customization_args[
                customizationArgSpec.name].value">
            </schema-based-editor>
            <div style="margin-bottom: 15px;"></div>
          </div>
        </div>
      </form>
    </div>
  </div>


  <div class="modal-footer">
    <button ng-show="!isEditingGadget" class="btn btn-default"
            ng-click="returnToGadgetSelector()" style="float: left;">
      Back
    </button>
    <button class="btn btn-default" ng-click="cancel()">Cancel</button>
    <button ng-click="save()" class="btn btn-success">
      <[isEditingGadget? 'Update' : 'Add']> Gadget
    </button>
  </div>
</script>

<script type="text/ng-template" id="modals/deleteGadget">
  <div class="modal-header">
    <h3>Delete Gadget</h3>
  </div>

  <div class="modal-body">
    <p>
      Are you sure you want to delete the gadget "<[deleteGadgetName]>"?
    </p>
  </div>

  <div class="modal-footer">
    <button class="btn btn-default" ng-click="cancel()">Cancel</button>
    <button class="btn btn-danger" ng-click="reallyDelete()">Delete Gadget</button>
  </div>
</script>
