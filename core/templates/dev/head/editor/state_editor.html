{% macro changelist_buttons_row() -%}
  <div class="row-fluid">
    <div class="span6 offset6">
      <button class="btn oppia-save-state-button pull-right" ng-click="discardStateChanges()" ng-disabled="!isStateLockedForEditing()">discard changes</button>
      <button class="btn oppia-save-state-button pull-right" ng-class="{'btn-success': isStateLockedForEditing()}" ng-click="saveStateChanges()" ng-disabled="!isStateLockedForEditing()">save changes</button>
    </div>
  </div>
{%- endmacro %}


<div class="container-fluid oppia-editor" ng-show="stateId">

  {{ changelist_buttons_row() }}
  
  <br>

  <div class="row-fluid">
    <div class="span2">
      <span class="oppia-editor-header">
        state name
      </span>
    </div>

    <div class="span8">
      <h3>
        <span ng-if="!stateNameMemento">
          <[stateName]>
        </span>
        <span ng-if="!!stateNameMemento">
          <input type="text" ng-model="stateName">
          <button ng-click="saveStateName(stateName)">Close</button>
        </span>
      </h3>
    </div>

    <div class="span2">
      <button ng-if="!stateNameMemento" ng-click="openStateNameEditor()" class="pull-right">
        Edit name
      </button>
    </div>
  </div>

  <br>

  <div class="row-fluid">
    <div class="span2">
      <a href="#" onclick="return false;" ng-click="toggleIncomingStates()">
        <span ng-if="!incomingStatesShown">
          <i class="icon-plus-sign oppia-cursor-pointer"></i>
        </span>
        <span ng-if="incomingStatesShown">
          <i class="icon-minus-sign oppia-cursor-pointer"></i>
        </span>
      </a>
      <span class="oppia-editor-header">
        incoming states
      </span>
    </div>

    <div class="span8">
      <div ng-if="incomingStatesShown">
        <ul>
          <li ng-repeat="(incomingStateId, incomingState) in getIncomingStates(stateId)">
            <a ng-if="stateId != incomingStateId" href="/create/<[explorationId]>#/gui/<[incomingStateId]>">
            <[incomingState.name]>
            </a>
            <span ng-if="stateId == incomingStateId" title="This state points to itself." class="oppia-cursor-pointer">
              ‚ü≥
            </span>
            (<[incomingState.rules | commaSeparatedList]>)
          </li>
        </ul>

        <span ng-show="isEmpty(getIncomingStates(stateId))">
          <em>No incoming states.</em>
        </span>
      </div>
    </div>

    <div class="span2">
    </div>
  </div>

  <br>


  <div class="row-fluid">
    <div class="span2">
      <a href="#" onclick="return false;" ng-click="toggleParameterChanges()">
        <span ng-if="!parameterChangesShown">
          <i class="icon-plus-sign oppia-cursor-pointer"></i>
        </span>
        <span ng-if="parameterChangesShown">
          <i class="icon-minus-sign oppia-cursor-pointer"></i>
        </span>
      </a>
      <span class="oppia-editor-header">
        parameter changes (<[stateParamChanges.length]>)
      </span>
      <img class="oppia-help" src="/images/help.png"
           tooltip="You can change any parameters associated with a reader who enters this state. A parameter can be accessed by typing {{'{{parameter_name}}'}} in the widget customization, rule definition or feedback fields."
           tooltip-placement="right">
    </div>

    <div class="span10">
      <param-change-editor param-changes="stateParamChanges" param-specs="paramSpecs" save-param-changes="saveStateParamChanges" add-exploration-param-spec="addExplorationParamSpec" ng-if="parameterChangesShown">
      </param-change-editor>
    </div>
  </div>

  <br>

  <div class="row-fluid">
    <div class="span2">
      <span class="oppia-editor-header">content</span>
    </div>

    <div class="span8 oppia-state-content">
      <div ng-if="!contentMemento">
        <span ng-if="content[0].value == ''" class="oppia-placeholder">
          <[defaultTextContent]>
        </span>
        <span angular-html-bind="content[0].value"></span>
      </div>

      <div ng-if="!!contentMemento">
        <rich-text-editor html-content="content[0].value"></rich-text-editor>
        <button ng-click="saveTextContent()">Close</button>
      </div>
    </div>

    <div class="span2">
      <button ng-if="!contentMemento" ng-click="editContent()" class="pull-right">
        Edit content
      </button>
    </div>
  </div>

  <br>

  {% include 'editor/interactive_widget_editor.html' %}

  <br>

  {{ changelist_buttons_row() }}
</div>


<script type="text/ng-template" id="modals/customizeWidget">
  <div class="modal-header">
    <h3>Customize This Widget</h3>
  </div>

  <div class="modal-body">
    The following widget parameters can be customized:
    <br><br>

    <div ng-repeat="(paramName, paramSpecDict) in widgetParamSpecs">
      <strong><[paramDescriptions[paramName]]></strong>
      <value-generator-editor generator-id="paramSpecDict.generator_id"
                              init-args="paramSpecDict.init_args"
                              customization-args="widgetCustomizationArgs[paramName]"
                              obj-type="paramSpecDict.obj_type">
      </value-generator-editor>
      <br>
    </div>
  </div>

  <div class="modal-footer">
    <input type="submit" class="btn" value="Use these parameters" ng-click="save(widgetCustomizationArgs)"/>
  </div>
</script>
